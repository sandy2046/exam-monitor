<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­˜å‚¨è°ƒè¯•å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        .section h3 {
            margin-top: 0;
            color: #333;
        }
        pre {
            background: #f8f8f8;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            background: #409eff;
            color: white;
        }
        button:hover {
            background: #337ecc;
        }
        button.danger {
            background: #f56c6c;
        }
        button.danger:hover {
            background: #dd6161;
        }
        .info {
            color: #666;
            font-size: 13px;
            margin-top: 5px;
        }
        .success {
            color: #67c23a;
        }
        .error {
            color: #f56c6c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” æ¨¡æ¿å­˜å‚¨è°ƒè¯•å·¥å…·</h1>
        <p class="info">ç”¨äºæ’æŸ¥æµ‹è¯•æ¨¡æ¿æ‰¾ä¸åˆ°çš„é—®é¢˜</p>

        <div class="section">
            <h3>1. å½“å‰å­˜å‚¨çŠ¶æ€</h3>
            <div id="storage-status"></div>
        </div>

        <div class="section">
            <h3>2. åŸå§‹æ•°æ®æŸ¥çœ‹</h3>
            <div>
                <h4>è¿œç¨‹æ¨¡æ¿ (remoteTemplates)</h4>
                <pre id="remote-data">åŠ è½½ä¸­...</pre>
                <h4>æœ¬åœ°æ¨¡æ¿ (localTemplates)</h4>
                <pre id="local-data">åŠ è½½ä¸­...</pre>
            </div>
        </div>

        <div class="section">
            <h3>3. æ“ä½œæµ‹è¯•</h3>
            <button onclick="createTestTemplate()">åˆ›å»ºæµ‹è¯•æ¨¡æ¿</button>
            <button onclick="createLocalTemplate()">åˆ›å»ºæœ¬åœ°æ¨¡æ¿</button>
            <button onclick="clearAll()">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
            <button onclick="refresh()">åˆ·æ–°è§†å›¾</button>
            <p class="info">ç‚¹å‡»"åˆ›å»ºæµ‹è¯•æ¨¡æ¿"åï¼ŒæŸ¥çœ‹æœ¬åœ°æ¨¡æ¿æ•°æ®æ˜¯å¦å¢åŠ </p>
        </div>

        <div class="section">
            <h3>4. æµ‹è¯•ç»“æœ</h3>
            <div id="test-result"></div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ¨¡æ¿æ•°æ®ç»“æ„
        function createTestTemplateData() {
            const newId = `test-${Date.now()}`;
            return {
                id: newId,
                name: 'æµ‹è¯•æ¨¡æ¿ - 20ç§’é—´éš”',
                version: '1.0',
                nodes: [
                    { name: 'èŠ‚ç‚¹1 - è€ƒç”Ÿå…¥åœº', offset: 0, warnTime: 0, description: 'æµ‹è¯•èŠ‚ç‚¹1 - 20ç§’åè¿›å…¥ä¸‹ä¸€ç¯èŠ‚' },
                    { name: 'èŠ‚ç‚¹2 - å‘å·', offset: 0.333, warnTime: 0, description: 'æµ‹è¯•èŠ‚ç‚¹2 - 20ç§’åè¿›å…¥ä¸‹ä¸€ç¯èŠ‚' },
                    { name: 'èŠ‚ç‚¹3 - å®£è¯»è§„åˆ™', offset: 0.667, warnTime: 0, description: 'æµ‹è¯•èŠ‚ç‚¹3 - 20ç§’åè¿›å…¥ä¸‹ä¸€ç¯èŠ‚' },
                    { name: 'èŠ‚ç‚¹4 - å¼€å§‹è€ƒè¯•', offset: 1.0, warnTime: 0, description: 'æµ‹è¯•èŠ‚ç‚¹4 - 20ç§’åè¿›å…¥ä¸‹ä¸€ç¯èŠ‚' },
                    { name: 'èŠ‚ç‚¹5 - ä¸­é€”æ£€æŸ¥', offset: 1.333, warnTime: 0, description: 'æµ‹è¯•èŠ‚ç‚¹5 - 20ç§’åè¿›å…¥ä¸‹ä¸€ç¯èŠ‚' },
                    { name: 'èŠ‚ç‚¹6 - æé†’æ”¶å·', offset: 1.667, warnTime: 0, description: 'æµ‹è¯•èŠ‚ç‚¹6 - 20ç§’åè¿›å…¥ä¸‹ä¸€ç¯èŠ‚' },
                    { name: 'èŠ‚ç‚¹7 - è€ƒè¯•ç»“æŸ', offset: 2.0, warnTime: 0, description: 'æµ‹è¯•èŠ‚ç‚¹7 - æµ‹è¯•ç»“æŸ' },
                ],
                isModified: true,
            };
        }

        function createLocalTemplateData() {
            const newId = `local-${Date.now()}`;
            return {
                id: newId,
                name: 'æ–°è€ƒè¯•æ¨¡æ¿',
                version: '1.0',
                nodes: [
                    { name: 'è€ƒç”Ÿå…¥åœº', offset: -30, warnTime: 5, description: 'æ¸…ç‚¹äººæ•°' },
                    { name: 'å‘å·', offset: 0, warnTime: 0, description: 'åˆ†å‘è¯•å·' },
                ],
                isModified: true,
            };
        }

        // è¯»å–æ•°æ®
        function getLocalTemplates() {
            const data = localStorage.getItem('exam_monitor_local_templates');
            return data ? JSON.parse(data) : [];
        }

        function getRemoteTemplates() {
            const data = localStorage.getItem('exam_monitor_remote_templates');
            return data ? JSON.parse(data) : [];
        }

        // ä¿å­˜æ•°æ®
        function saveLocalTemplates(templates) {
            localStorage.setItem('exam_monitor_local_templates', JSON.stringify(templates));
        }

        // åˆ·æ–°æ˜¾ç¤º
        function refresh() {
            // çŠ¶æ€
            const remote = getRemoteTemplates();
            const local = getLocalTemplates();

            document.getElementById('storage-status').innerHTML = `
                <div style="font-size: 14px;">
                    <div>è¿œç¨‹æ¨¡æ¿æ•°é‡: <strong>${remote.length}</strong></div>
                    <div>æœ¬åœ°æ¨¡æ¿æ•°é‡: <strong>${local.length}</strong></div>
                    <div style="margin-top: 10px;">
                        <span class="${local.length > 0 ? 'success' : 'error'}">
                            ${local.length > 0 ? 'âœ… æœ‰æœ¬åœ°æ¨¡æ¿æ•°æ®' : 'âŒ æ²¡æœ‰æœ¬åœ°æ¨¡æ¿æ•°æ®'}
                        </span>
                    </div>
                </div>
            `;

            // åŸå§‹æ•°æ®
            document.getElementById('remote-data').textContent = JSON.stringify(remote, null, 2);
            document.getElementById('local-data').textContent = JSON.stringify(local, null, 2);
        }

        // åˆ›å»ºæµ‹è¯•æ¨¡æ¿
        function createTestTemplate() {
            const template = createTestTemplateData();
            const local = getLocalTemplates();
            local.push(template);
            saveLocalTemplates(local);

            const result = document.getElementById('test-result');
            result.innerHTML = `
                <div class="success">âœ… æµ‹è¯•æ¨¡æ¿å·²åˆ›å»º</div>
                <div>ID: ${template.id}</div>
                <div>åç§°: ${template.name}</div>
                <div>èŠ‚ç‚¹æ•°: ${template.nodes.length}</div>
            `;

            refresh();
        }

        // åˆ›å»ºæœ¬åœ°æ¨¡æ¿
        function createLocalTemplate() {
            const template = createLocalTemplateData();
            const local = getLocalTemplates();
            local.push(template);
            saveLocalTemplates(local);

            const result = document.getElementById('test-result');
            result.innerHTML = `
                <div class="success">âœ… æœ¬åœ°æ¨¡æ¿å·²åˆ›å»º</div>
                <div>ID: ${template.id}</div>
                <div>åç§°: ${template.name}</div>
            `;

            refresh();
        }

        // æ¸…ç©ºæ‰€æœ‰æ•°æ®
        function clearAll() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
                localStorage.removeItem('exam_monitor_local_templates');
                localStorage.removeItem('exam_monitor_remote_templates');
                localStorage.removeItem('exam_monitor_active_exam');
                localStorage.removeItem('exam_monitor_settings');
                localStorage.removeItem('exam_monitor_last_sync');

                document.getElementById('test-result').innerHTML = '<div class="error">ğŸ—‘ï¸ æ‰€æœ‰æ•°æ®å·²æ¸…ç©º</div>';
                refresh();
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åˆ·æ–°
        window.addEventListener('load', refresh);
    </script>
</body>
</html>
